<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                   https://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-latest.xsd">
    <changeSet id="1 create table account" author="serhii kurlykin">

        <sql>
            create table account (
                                     balance numeric(38,2),
                                     id bigint generated by default as identity,
                                     client_id varchar(255),
                                     name varchar(255),
                                     currency_code enum ('CNY','EUR','GBP','JPY','RUB','USD'),
                                     status enum ('ACTIVE','BLOCKED','INACTIVE'),
                                     type enum ('CHECKING','CREDIT_CARD','DEBIT_CARD','LOAN','OTHER','SAVINGS'),
                                     primary key (id)
            );
        </sql>
    </changeSet>

    <changeSet id="2 create table client" author="serhii kurlykin">
        <sql>
            create table client (
                                    address varchar(255),
                                    email varchar(255),
                                    first_name varchar(255),
                                    id varchar(255) not null,
                                    last_name varchar(255),
                                    phone varchar(255),
                                    tax_code varchar(255),
                                    status enum ('ACTIVE','BLOCKED','INACTIVE'),
                                    primary key (id)
            );

        </sql>
    </changeSet>

    <changeSet id="3 create table transaction" author="serhii kurlykin">
        <sql>
            create table transaction (
                                         amount numeric(38,2),
                                         from_account_id bigint,
                                         to_account_id bigint,
                                         description varchar(255),
                                         id varchar(255) not null,
                                         currency_code enum ('CNY','EUR','GBP','JPY','RUB','USD'),
                                         status enum ('APPROVED','NEW','PENDING'),
                                         type enum ('CASH','DEPOSIT','PAYMENT','REFUND','TRANSFER'),
                                         primary key (id)
            );
        </sql>
    </changeSet>

    <changeSet id="4 create table card" author="serhii kurlykin">
        <sql>
            create table card (
                                  cvv integer,
                                  account_id bigint unique,
                                  card_holder varchar(255),
                                  card_number varchar(255),
                                  expiry_date varchar(255),
                                  id varchar(255) not null,
                                  card_type enum ('MASTERCARD','VISA'),
                                  primary key (id)
            );
        </sql>
    </changeSet>

    <changeSet id="5 create" author="serhii kurlykin">
        <sql>
            alter table if exists account
                add constraint FKkm8yb63h4ownvnlrbwnadntyn
                foreign key (client_id)
                references client;

            alter table if exists card
                add constraint FK8v67eys6tqflsm6hrdgru2phu
                foreign key (account_id)
                references account;

            alter table if exists transaction
                add constraint FKrff4jlxetafju1e5cks5mfcnk
                foreign key (from_account_id)
                references account;

            alter table if exists transaction
                add constraint FKluqt8k2pa8d4gmggx4rhl5vgv
                foreign key (to_account_id)
                references account;
        </sql>
    </changeSet>

</databaseChangeLog>